<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Todo List</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 2rem; max-width: 640px; }
      form { display: flex; gap: 0.5rem; margin: 1rem 0; }
      input[type="text"] { flex: 1; padding: 0.6rem; }
      button { padding: 0.6rem 0.9rem; cursor: pointer; }
      ul { padding-left: 1.25rem; }
      li { margin: 0.5rem 0; display: flex; align-items: center; gap: 0.6rem; }
      li span { flex: 1; }
      .muted { color: #666; font-size: 0.95rem; }
    </style>
  </head>

  <body>
    <h1>Todos</h1>
    <p class="muted">Loads from DB. Add and delete using POST endpoints.</p>

    <!-- Add Todo -->
    <form id="todo-form">
      <input id="todo-input" type="text" placeholder="New todo..." autocomplete="off" required />
      <button type="submit">Add</button>
    </form>

    <ul id="todo-list"></ul>

    <script>
      // Adjust these to match your backend routes.
      const API = {
        list: "/api/todos",          // GET -> [{id, title}, ...]
        add: "/api/todos",           // POST -> creates a todo
        del: (id) => `/api/todos/${id}/delete` // POST -> deletes a todo (example)
      };

      const listEl = document.getElementById("todo-list");
      const formEl = document.getElementById("todo-form");
      const inputEl = document.getElementById("todo-input");

      function renderTodos(todos) {
        listEl.innerHTML = "";

        if (!Array.isArray(todos) || todos.length === 0) {
          const li = document.createElement("li");
          li.className = "muted";
          li.textContent = "No todos found.";
          listEl.appendChild(li);
          return;
        }

        for (const t of todos) {
          const li = document.createElement("li");

          const text = document.createElement("span");
          text.textContent = t.title ?? String(t);

          const delBtn = document.createElement("button");
          delBtn.type = "button";
          delBtn.textContent = "Delete";
          delBtn.addEventListener("click", () => deleteTodo(t.id));

          li.appendChild(text);
          li.appendChild(delBtn);
          listEl.appendChild(li);
        }
      }

      async function loadTodos() {
        listEl.innerHTML = "<li class='muted'>Loading...</li>";
        try {
          const res = await fetch(API.list);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const todos = await res.json();
          renderTodos(todos);
        } catch (err) {
          console.error(err);
          listEl.innerHTML = "<li class='muted'>Failed to load todos.</li>";
        }
      }

      async function addTodo(title) {
        // Example body: { "title": "Buy milk" }
        const res = await fetch(API.add, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title })
        });
        if (!res.ok) throw new Error(`Add failed: HTTP ${res.status}`);
      }

      async function deleteTodo(id) {
        if (id === undefined || id === null || id === "") return;

        // Example body: { "id": 123 } OR just use the URL, depending on your backend.
        const res = await fetch(API.del(id), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id })
        });
        if (!res.ok) throw new Error(`Delete failed: HTTP ${res.status}`);

        await loadTodos();
      }

      formEl.addEventListener("submit", async (e) => {
        e.preventDefault();
        const title = inputEl.value.trim();
        if (!title) return;

        try {
          await addTodo(title);
          inputEl.value = "";
          await loadTodos();
        } catch (err) {
          console.error(err);
          alert("Failed to add todo.");
        }
      });

      loadTodos();
    </script>
  </body>
</html>
